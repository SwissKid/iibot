#!/bin/bash
channel=$@
source runningconf.cnf
source functions
touch "$ircdir/$server/$channel/out"
joined=true
tailf -n1 "$ircdir/$server/$channel/out" |\
 while read -r date time nick msg; do
	set -- $msg
	start=$1
	shift
	rest=$@
	truenick=$(echo $nick | sed -e "s/^<//" -e "s/>$//")

	joined=$(tail -n1 "in/$channel")
	if [ "$joined" == "false" ]; then
		exit 0
	fi
	if [ "$(echo $channel | head -c 1)" == '#' ]; then
		if [[ "$msg" == swissboxbot:* ]]; then
			./scripts/saymyname $channel $truenick $msg
			echo "$date $time $nick $msg" >&3
		fi
	elif [ "$truenick" == "$channel" ]; then
		./script/saymyname $channel $truenick $msg
	else
		msgowner $channel and $truenick are giving me issues!
		echo "/p $channel :\"I broke!\"" >> "$ircdir/$server/in"
		echo "$channel and $truenick and $msg caused errors in commandme" >&2
		exit 1
	fi
done
